<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Methods common to all AIO operations"><meta name="keywords" content="rust, rustlang, rust-lang, Aio"><title>Aio in nix::sys::aio - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../nix/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../nix/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Aio</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#required-associated-types">Required Associated Types</a></h3><ul><li><a href="#associatedtype.Output">Output</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.aio_return">aio_return</a></li><li><a href="#tymethod.cancel">cancel</a></li><li><a href="#tymethod.error">error</a></li><li><a href="#tymethod.fd">fd</a></li><li><a href="#tymethod.in_progress">in_progress</a></li><li><a href="#tymethod.priority">priority</a></li><li><a href="#tymethod.set_sigev_notify">set_sigev_notify</a></li><li><a href="#tymethod.sigevent">sigevent</a></li><li><a href="#tymethod.submit">submit</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In nix::sys::aio</a></h2></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../nix/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Trait <a href="../../index.html">nix</a>::<wbr><a href="../index.html">sys</a>::<wbr><a href="index.html">aio</a>::<wbr><a class="trait" href="#">Aio</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/nix/sys/aio.rs.html#214-359">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait Aio {
    type <a href="#associatedtype.Output" class="associatedtype">Output</a>;

    fn <a href="#tymethod.aio_return" class="fnname">aio_return</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;Self::<a class="associatedtype" href="trait.Aio.html#associatedtype.Output" title="type nix::sys::aio::Aio::Output">Output</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.cancel" class="fnname">cancel</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="enum" href="enum.AioCancelStat.html" title="enum nix::sys::aio::AioCancelStat">AioCancelStat</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.error" class="fnname">error</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.fd" class="fnname">fd</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/std/os/fd/raw/type.RawFd.html" title="type std::os::fd::raw::RawFd">RawFd</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.in_progress" class="fnname">in_progress</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.priority" class="fnname">priority</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.i32.html">i32</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.set_sigev_notify" class="fnname">set_sigev_notify</a>(&amp;mut self, sev: <a class="enum" href="../signal/enum.SigevNotify.html" title="enum nix::sys::signal::SigevNotify">SigevNotify</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.sigevent" class="fnname">sigevent</a>(&amp;self) -&gt; <a class="struct" href="../signal/struct.SigEvent.html" title="struct nix::sys::signal::SigEvent">SigEvent</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.submit" class="fnname">submit</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Methods common to all AIO operations</p>
</div></details><h2 id="required-associated-types" class="small-section-header">Required Associated Types<a href="#required-associated-types" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="associatedtype.Output" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#216">source</a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a></h4></div></summary><div class="docblock"><p>The return type of <a href="trait.Aio.html#tymethod.aio_return" title="Aio::aio_return"><code>Aio::aio_return</code></a>.</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.aio_return" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#227">source</a><h4 class="code-header">fn <a href="#tymethod.aio_return" class="fnname">aio_return</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;Self::<a class="associatedtype" href="trait.Aio.html#associatedtype.Output" title="type nix::sys::aio::Aio::Output">Output</a>&gt;</h4></div></summary><div class="docblock"><p>Retrieve return status of an asynchronous operation.</p>
<p>Should only be called once for each operation, after <a href="trait.Aio.html#tymethod.error" title="Aio::error"><code>Aio::error</code></a>
indicates that it has completed.  The result is the same as for the
synchronous <code>read(2)</code>, <code>write(2)</code>, of <code>fsync(2)</code> functions.</p>
<h5 id="references"><a href="#references">References</a></h5>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_return.html">aio_return</a></p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.cancel" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#273">source</a><h4 class="code-header">fn <a href="#tymethod.cancel" class="fnname">cancel</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="enum" href="enum.AioCancelStat.html" title="enum nix::sys::aio::AioCancelStat">AioCancelStat</a>&gt;</h4></div></summary><div class="docblock"><p>Cancels an outstanding AIO request.</p>
<p>The operating system is not required to implement cancellation for all
file and device types.  Even if it does, there is no guarantee that the
operation has not already completed.  So the caller must check the
result and handle operations that were not canceled or that have already
completed.</p>
<h5 id="examples"><a href="#examples">Examples</a></h5>
<p>Cancel an outstanding aio operation.  Note that we must still call
<code>aio_return</code> to free resources, even though we don’t care about the
result.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>wbuf = <span class="string">b&quot;CDEF&quot;</span>;
<span class="kw">let </span><span class="kw-2">mut </span>f = tempfile().unwrap();
<span class="kw">let </span><span class="kw-2">mut </span>aiocb = Box::pin(AioWrite::new(f.as_raw_fd(),
    <span class="number">2</span>,   <span class="comment">//offset
    </span><span class="kw-2">&amp;</span>wbuf[..],
    <span class="number">0</span>,   <span class="comment">//priority
    </span>SigevNotify::SigevNone));
aiocb.as_mut().submit().unwrap();
<span class="kw">let </span>cs = aiocb.as_mut().cancel().unwrap();
<span class="kw">if </span>cs == AioCancelStat::AioNotCanceled {
    <span class="kw">while </span>(aiocb.as_mut().error() == <span class="prelude-val">Err</span>(Errno::EINPROGRESS)) {
        thread::sleep(time::Duration::from_millis(<span class="number">10</span>));
    }
}
<span class="comment">// Must call `aio_return`, but ignore the result
</span><span class="kw">let _ </span>= aiocb.as_mut().aio_return();</code></pre></div>
<h5 id="references-1"><a href="#references-1">References</a></h5>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_cancel.html">aio_cancel</a></p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.error" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#310">source</a><h4 class="code-header">fn <a href="#tymethod.error" class="fnname">error</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></div></summary><div class="docblock"><p>Retrieve error status of an asynchronous operation.</p>
<p>If the request has not yet completed, returns <code>EINPROGRESS</code>.  Otherwise,
returns <code>Ok</code> or any other error.</p>
<h5 id="examples-1"><a href="#examples-1">Examples</a></h5>
<p>Issue an aio operation and use <code>error</code> to poll for completion.  Polling
is an alternative to <code>aio_suspend</code>, used by most of the other examples.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">const </span>WBUF: <span class="kw-2">&amp;</span>[u8] = <span class="string">b&quot;abcdef123456&quot;</span>;
<span class="kw">let </span><span class="kw-2">mut </span>f = tempfile().unwrap();
<span class="kw">let </span><span class="kw-2">mut </span>aiocb = Box::pin(AioWrite::new(f.as_raw_fd(),
    <span class="number">2</span>,   <span class="comment">//offset
    </span>WBUF,
    <span class="number">0</span>,   <span class="comment">//priority
    </span>SigevNotify::SigevNone));
aiocb.as_mut().submit().unwrap();
<span class="kw">while </span>(aiocb.as_mut().error() == <span class="prelude-val">Err</span>(Errno::EINPROGRESS)) {
    thread::sleep(time::Duration::from_millis(<span class="number">10</span>));
}
<span class="macro">assert_eq!</span>(aiocb.as_mut().aio_return().unwrap(), WBUF.len());</code></pre></div>
<h5 id="references-2"><a href="#references-2">References</a></h5>
<p><a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/aio_error.html">aio_error</a></p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.fd" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#313">source</a><h4 class="code-header">fn <a href="#tymethod.fd" class="fnname">fd</a>(&amp;self) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/std/os/fd/raw/type.RawFd.html" title="type std::os::fd::raw::RawFd">RawFd</a></h4></div></summary><div class="docblock"><p>Returns the underlying file descriptor associated with the operation.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.in_progress" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#342">source</a><h4 class="code-header">fn <a href="#tymethod.in_progress" class="fnname">in_progress</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a></h4></div></summary><div class="docblock"><p>Does this operation currently have any in-kernel state?</p>
<p>Dropping an operation that does have in-kernel state constitutes a
resource leak.</p>
<h5 id="examples-2"><a href="#examples-2">Examples</a></h5>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>f = tempfile().unwrap();
<span class="kw">let </span><span class="kw-2">mut </span>aiof = Box::pin(AioFsync::new(f.as_raw_fd(), AioFsyncMode::O_SYNC,
    <span class="number">0</span>, SigevNone));
<span class="macro">assert!</span>(!aiof.as_mut().in_progress());
aiof.as_mut().submit().expect(<span class="string">&quot;aio_fsync failed early&quot;</span>);
<span class="macro">assert!</span>(aiof.as_mut().in_progress());
<span class="kw">while </span>(aiof.as_mut().error() == <span class="prelude-val">Err</span>(Errno::EINPROGRESS)) {
    thread::sleep(time::Duration::from_millis(<span class="number">10</span>));
}
aiof.as_mut().aio_return().expect(<span class="string">&quot;aio_fsync failed late&quot;</span>);
<span class="macro">assert!</span>(!aiof.as_mut().in_progress());</code></pre></div>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.priority" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#345">source</a><h4 class="code-header">fn <a href="#tymethod.priority" class="fnname">priority</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.i32.html">i32</a></h4></div></summary><div class="docblock"><p>Returns the priority of the <code>AioCb</code></p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.set_sigev_notify" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#349">source</a><h4 class="code-header">fn <a href="#tymethod.set_sigev_notify" class="fnname">set_sigev_notify</a>(&amp;mut self, sev: <a class="enum" href="../signal/enum.SigevNotify.html" title="enum nix::sys::signal::SigevNotify">SigevNotify</a>)</h4></div></summary><div class="docblock"><p>Update the notification settings for an existing AIO operation that has
not yet been submitted.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.sigevent" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#352">source</a><h4 class="code-header">fn <a href="#tymethod.sigevent" class="fnname">sigevent</a>(&amp;self) -&gt; <a class="struct" href="../signal/struct.SigEvent.html" title="struct nix::sys::signal::SigEvent">SigEvent</a></h4></div></summary><div class="docblock"><p>Returns the <code>SigEvent</code> that will be used for notification.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.submit" class="method has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#358">source</a><h4 class="code-header">fn <a href="#tymethod.submit" class="fnname">submit</a>(self: <a class="struct" href="https://doc.rust-lang.org/nightly/core/pin/struct.Pin.html" title="struct core::pin::Pin">Pin</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut </a>Self&gt;) -&gt; <a class="type" href="../../type.Result.html" title="type nix::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></div></summary><div class="docblock"><p>Actually start the I/O operation.</p>
<p>After calling this method and until <a href="trait.Aio.html#tymethod.aio_return" title="Aio::aio_return"><code>Aio::aio_return</code></a> returns <code>Ok</code>,
the structure may not be moved in memory.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Aio-for-AioFsync" class="impl has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#476-493">source</a><a href="#impl-Aio-for-AioFsync" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.Aio.html" title="trait nix::sys::aio::Aio">Aio</a> for <a class="struct" href="struct.AioFsync.html" title="struct nix::sys::aio::AioFsync">AioFsync</a></h3></section></summary><div class="impl-items"><section id="associatedtype.Output-1" class="associatedtype trait-impl has-srclink"><a href="#associatedtype.Output-1" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Aio-for-AioRead%3C%27a%3E" class="impl has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#601-605">source</a><a href="#impl-Aio-for-AioRead%3C%27a%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;'a&gt; <a class="trait" href="trait.Aio.html" title="trait nix::sys::aio::Aio">Aio</a> for <a class="struct" href="struct.AioRead.html" title="struct nix::sys::aio::AioRead">AioRead</a>&lt;'a&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Output-2" class="associatedtype trait-impl has-srclink"><a href="#associatedtype.Output-2" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a></h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Aio-for-AioWrite%3C%27a%3E" class="impl has-srclink"><a class="srclink rightside" href="../../../src/nix/sys/aio.rs.html#837-841">source</a><a href="#impl-Aio-for-AioWrite%3C%27a%3E" class="anchor"></a><h3 class="code-header in-band">impl&lt;'a&gt; <a class="trait" href="trait.Aio.html" title="trait nix::sys::aio::Aio">Aio</a> for <a class="struct" href="struct.AioWrite.html" title="struct nix::sys::aio::AioWrite">AioWrite</a>&lt;'a&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Output-3" class="associatedtype trait-impl has-srclink"><a href="#associatedtype.Output-3" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Output" class="associatedtype">Output</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a></h4></section></div></details></div><script src="../../../implementors/nix/sys/aio/trait.Aio.js" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="nix" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.0-nightly (98ad6a551 2022-09-17)" ></div></body></html>