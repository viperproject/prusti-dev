<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Task abstraction for building executors."><meta name="keywords" content="rust, rustlang, rust-lang, async_task"><title>async_task - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../async_task/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../async_task/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate async_task</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 4.3.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../async_task/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">async_task</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/async_task/lib.rs.html#1-99">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Task abstraction for building executors.</p>
<p>To spawn a future onto an executor, we first need to allocate it on the heap and keep some
state attached to it. The state indicates whether the future is ready for polling, waiting to
be woken up, or completed. Such a stateful future is called a <em>task</em>.</p>
<p>All executors have a queue that holds scheduled tasks:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let</span> (<span class="ident">sender</span>, <span class="ident">receiver</span>) <span class="op">=</span> <span class="ident">flume::unbounded</span>();</code></pre></div>
<p>A task is created using either <a href="fn.spawn.html" title="spawn()"><code>spawn()</code></a>, <a href="fn.spawn_local.html" title="spawn_local()"><code>spawn_local()</code></a>, or <a href="fn.spawn_unchecked.html" title="spawn_unchecked()"><code>spawn_unchecked()</code></a> which
return a <a href="struct.Runnable.html" title="Runnable"><code>Runnable</code></a> and a <a href="struct.Task.html" title="Task"><code>Task</code></a>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// A future that will be spawned.</span>
<span class="kw">let</span> <span class="ident">future</span> <span class="op">=</span> <span class="kw">async</span> { <span class="number">1</span> <span class="op">+</span> <span class="number">2</span> };

<span class="comment">// A function that schedules the task when it gets woken up.</span>
<span class="kw">let</span> <span class="ident">schedule</span> <span class="op">=</span> <span class="kw">move</span> <span class="op">|</span><span class="ident">runnable</span><span class="op">|</span> <span class="ident">sender</span>.<span class="ident">send</span>(<span class="ident">runnable</span>).<span class="ident">unwrap</span>();

<span class="comment">// Construct a task.</span>
<span class="kw">let</span> (<span class="ident">runnable</span>, <span class="ident">task</span>) <span class="op">=</span> <span class="ident">async_task::spawn</span>(<span class="ident">future</span>, <span class="ident">schedule</span>);

<span class="comment">// Push the task into the queue by invoking its schedule function.</span>
<span class="ident">runnable</span>.<span class="ident">schedule</span>();</code></pre></div>
<p>The <a href="struct.Runnable.html" title="Runnable"><code>Runnable</code></a> is used to poll the task’s future, and the <a href="struct.Task.html" title="Task"><code>Task</code></a> is used to await its
output.</p>
<p>Finally, we need a loop that takes scheduled tasks from the queue and runs them:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">for</span> <span class="ident">runnable</span> <span class="kw">in</span> <span class="ident">receiver</span> {
    <span class="ident">runnable</span>.<span class="ident">run</span>();
}</code></pre></div>
<p>Method <a href="struct.Runnable.html#method.run" title="Runnable::run()"><code>run()</code></a> polls the task’s future once. Then, the <a href="struct.Runnable.html" title="Runnable"><code>Runnable</code></a>
vanishes and only reappears when its <a href="https://doc.rust-lang.org/nightly/core/task/wake/struct.Waker.html" title="core::task::Waker"><code>Waker</code></a> wakes the task, thus
scheduling it to be run again.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.FallibleTask.html" title="async_task::FallibleTask struct">FallibleTask</a></div><div class="item-right docblock-short"><p>A spawned task with a fallible response.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Runnable.html" title="async_task::Runnable struct">Runnable</a></div><div class="item-right docblock-short"><p>A handle to a runnable task.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Task.html" title="async_task::Task struct">Task</a></div><div class="item-right docblock-short"><p>A spawned task.</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.spawn.html" title="async_task::spawn fn">spawn</a></div><div class="item-right docblock-short"><p>Creates a new task.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.spawn_local.html" title="async_task::spawn_local fn">spawn_local</a></div><div class="item-right docblock-short"><p>Creates a new thread-local task.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.spawn_unchecked.html" title="async_task::spawn_unchecked fn">spawn_unchecked</a><a title="unsafe function" href="#"><sup>⚠</sup></a></div><div class="item-right docblock-short"><p>Creates a new task without <a href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="Send"><code>Send</code></a>, <a href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="Sync"><code>Sync</code></a>, and <code>'static</code> bounds.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="async_task" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (f9cba6374 2022-07-31)" ></div></body></html>